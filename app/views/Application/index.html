#{extends 'main.html'/}
#{set 'moreScripts'}
	<script src="@{'/public/javascripts/d3.js'}" type="text/javascript"></script>
	<script src="@{'/public/javascripts/d3.layout.cloud.js'}" type="text/javascript"></script>

#{/set}

#{set 'moreStyles'}
<style>
body{
	padding-top:60px;
}

</style>
#{/set}

<div class="row">
	<div id="vis" class="span4 well"></div>
	<div class="well span4">
		<form>
			<textarea class="input-xlarge" id="words" name="words" rows="3"></textarea><br/>
			<a class="btn btn-large btn-primary" href="javascript:updateWords();">Update</a>
		</form>
	</div>
</div>
<script type="text/javascript">
	var fill = d3.scale.category20b();
	
	var w = 350,
	    h = 350;
	var wordArray =  ["padlock","lasso","coat","stiletto","duck","sunset","kennel"];
	var wordInput = wordArray.map(function(d) {
	        return {text: d, size: d.length + Math.random() * 90};
	      });
	var max,
	    scale = 1,
	    complete = 0,
	    keyword = "",
	    tags,
	    fontSize,
	    maxLength = 30;
	
	var layout = d3.layout.cloud()
	    .timeInterval(10)
	    .size([w, h])
	    .words(wordInput)
		.fontSize(function(d) { return d.size; })
	    .text(function(d) { return d.text; })
	    .rotate(function() { return ~~(Math.random() * 2) *1; })
	    .on("end", draw)
	    .start();
	
	var svg = d3.select("#vis").append("svg")
	    .attr("width", w)
	    .attr("height", h);
	
	var background = svg.append("g"),
	    vis = svg.append("g")
	    		 .attr("transform", "translate(" + [w >> 1, h >> 1] + ")");
	
	
	function draw(data, bounds) {
	  console.log('>>>>>>>draw called');
	  scale = bounds ? Math.min(
	      w / Math.abs(bounds[1].x - w / 2),
	      w / Math.abs(bounds[0].x - w / 2),
	      h / Math.abs(bounds[1].y - h / 2),
	      h / Math.abs(bounds[0].y - h / 2)) / 2 : 1;
	  console.log(data);
	  var text = vis.selectAll("text")
	      .data(data, function(d) { 
	      	return d.text
	      });
	  text.transition()
	      .duration(1000)
	      .attr("transform", function(d) { return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")"; })
	      .style("font-size", function(d) { return d.size + "px"; });
	  text.enter().append("text")
	      .attr("text-anchor", "middle")
	      .attr("transform", function(d) { return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")"; })
	      .style("font-size", function(d) { return d.size + "px"; })
	    .transition()
	      .duration(1000);
	  text.style("font-family", function(d) { return d.font; })
	      .style("fill", "black")
	      .text(function(d) { 
	      	return d.text;
	      });
	  text.style("font-family", function(d) { return d.font; })
	      .style("fill", function(d) { return fill(d.text); })
	      .text(function(d) { return d.text; });
	  
	  text.exit().remove();
	}
	
	function updateWords(){
	
		var wordArray1 = $("#words").val().split(",");
		console.log(wordArray1);
		var wordInput1 = wordArray1.map(function(d) {
	        return {text: d, size: d.length + Math.random() * 90};
	      });
		console.log(wordInput1);
		layout.stop().words(wordInput1).start();
	}
	
	
</script>